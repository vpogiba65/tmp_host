# Инструкция по установке и запуску ASN Registry Server

## Требования

- **Node.js** версии 18.0.0 или выше
- **npm** (обычно устанавливается с Node.js)
- **Windows 10/11** (тестировалось на Windows 10)

## Установка

### 1. Клонирование/Скачивание проекта

Если у вас есть Git:
```bash
git clone <repository-url>
cd tmp_host
```

Или скачайте файлы проекта в папку `C:\tmp_host`

### 2. Установка зависимостей

Откройте командную строку в папке проекта:
```bash
cd C:\tmp_host
npm install
```

Это установит все необходимые пакеты:
- `express` - веб-сервер
- `sqlite3` - база данных
- `uuid` - генерация GUID
- `dayjs` - работа с датами
- `cors` - кросс-доменные запросы
- `helmet` - безопасность
- `express-rate-limit` - ограничение запросов
- `morgan` - логирование
- `joi` - валидация данных
- `jest` - тестирование
- `supertest` - тестирование API

## Запуск сервера

### Способ 1: Через npm script
```bash
npm start
```

### Способ 2: Прямой запуск
```bash
node server.js
```

### Способ 3: В фоновом режиме (Windows)
```bash
start /B node server.js
```

## Проверка работы

### 1. Проверка сервера
Откройте браузер и перейдите по адресу:
```
http://localhost:3000
```

Вы должны увидеть веб-интерфейс для управления сервером.

### 2. Проверка API
Откройте командную строку и выполните:
```bash
curl http://localhost:3000/health
```

Ожидаемый ответ:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "version": "1.0.0"
}
```

### 3. Проверка реестра ASN
```bash
curl http://localhost:3000/api/v1/registry
```

### 4. Запуск тестов
```bash
npm test
```

## Использование веб-интерфейса

### 1. Управление сервером
- **Запуск сервера** - нажмите кнопку "Запустить сервер"
- **Остановка сервера** - используйте Ctrl+C в терминале
- **Статус** - индикатор показывает состояние сервера

### 2. Редактирование ASN
- **Добавление** - нажмите "Добавить ASN" и введите 16 цифр
- **Редактирование** - кликните на номер ASN и измените
- **Удаление** - нажмите кнопку корзины рядом с ASN
- **Генерация реестра** - нажмите "Сгенерировать реестр"

### 3. Просмотр событий
- **Список пакетов** - таблица всех полученных пакетов
- **Детали события** - кликните "Детали" для просмотра
- **Обновление** - нажмите "Обновить" для загрузки новых данных

## Структура проекта

```
C:\tmp_host\
├── server.js              # Основной сервер
├── db.js                  # База данных SQLite
├── package.json           # Зависимости и скрипты
├── README.md              # Основная документация
├── API_DOCUMENTATION.md   # Документация API
├── INSTALLATION_GUIDE.md  # Эта инструкция
├── routes\                # Роуты API
│   ├── registry.js        # Реестр ASN
│   ├── events.js          # События
│   └── admin.js           # Административные функции
├── middleware\            # Middleware
│   ├── errorHandler.js    # Обработка ошибок
│   └── validation.js      # Валидация данных
├── public\                # Веб-интерфейс
│   ├── index.html         # Главная страница
│   ├── styles.css         # Стили
│   └── app.js             # JavaScript логика
└── tests\                 # Тесты
    ├── registry.test.js   # Тесты реестра
    ├── events.test.js     # Тесты событий
    └── admin.test.js      # Тесты админки
```

## Конфигурация

### Переменные окружения
Создайте файл `.env` в корне проекта:
```env
PORT=3000
NODE_ENV=development
```

### Изменение порта
По умолчанию сервер запускается на порту 3000. Для изменения:
```bash
set PORT=8080
npm start
```

## Устранение неполадок

### 1. Ошибка "Port already in use"
```bash
# Найти процесс на порту 3000
netstat -ano | findstr :3000

# Остановить процесс (замените PID на найденный ID)
taskkill /F /PID <PID>
```

### 2. Ошибка "Cannot find module"
```bash
# Переустановить зависимости
npm install
```

### 3. Ошибка базы данных
```bash
# Удалить файл базы данных
del events.db

# Перезапустить сервер
npm start
```

### 4. Проблемы с правами доступа
Запустите командную строку от имени администратора.

## Логи

Сервер выводит логи в консоль:
- HTTP запросы (Morgan)
- Ошибки валидации
- Ошибки базы данных
- Информация о запуске

## Безопасность

### В продакшене рекомендуется:
1. **Аутентификация** - добавить JWT токены
2. **HTTPS** - настроить SSL сертификат
3. **Ограничения** - настроить CORS для конкретных доменов
4. **Логирование** - настроить файловые логи
5. **Мониторинг** - добавить health checks

## Обновление

### Обновление зависимостей
```bash
npm update
```

### Обновление кода
Замените файлы проекта новыми версиями и перезапустите сервер.

## Поддержка

При возникновении проблем:
1. Проверьте логи в консоли
2. Убедитесь, что все зависимости установлены
3. Проверьте, что порт 3000 свободен
4. Запустите тесты: `npm test`

---

**Версия инструкции:** 1.0.0  
**Последнее обновление:** 2024-01-01 